# UI技术规范文档

**项目**: 《锈湖：炼金术士的天体仪》  
**文档类型**: UI技术实现规范  
**版本**: 1.0  
**日期**: 2025-12-09

---

## 1. 技术参数总览

### 1.1 目标平台与分辨率

本游戏主要针对Android移动设备开发，UI设计需要适配多种屏幕尺寸和比例。

**基准分辨率**: 1920 x 1080 (16:9)  
**适配范围**: 
- 1280 x 720 (16:9, 低端设备)
- 2560 x 1440 (16:9, 高端设备)
- 2340 x 1080 (19.5:9, 全面屏)

**设计策略**: 采用锚点系统和Canvas Scaler的Scale With Screen Size模式，确保UI元素在不同分辨率下保持相对位置和比例。关键交互区域应保持在安全区内，避免被刘海屏或圆角遮挡。

### 1.2 UI框架

**引擎**: Unreal Engine 4.27 UMG (Unreal Motion Graphics)  
**UI管理**: 通过`UUIManagerSubsystem`统一管理所有UI的创建、显示、隐藏和销毁。  
**层级管理**: 定义清晰的Z-Order层级，确保UI元素按正确顺序显示。

**层级定义**:
- **Layer 0 (Background)**: 游戏场景本身
- **Layer 100 (HUD)**: 主游戏界面元素（背包按钮、菜单按钮）
- **Layer 200 (Dialogue)**: 对话和独白文本框
- **Layer 300 (Inventory)**: 背包界面
- **Layer 400 (Puzzle)**: 特写谜题界面
- **Layer 500 (Menu)**: 暂停菜单和设置
- **Layer 600 (Popup)**: 符号获取等特殊弹窗
- **Layer 700 (Transition)**: 场景过渡效果

---

## 2. 核心UI组件详细规范

### 2.1 主游戏界面 (HUD)

**组件名称**: `WBP_MainHUD`

#### 背包入口按钮
- **位置**: 屏幕右下角，距离右边缘和底部边缘各60像素（基于1920x1080）
- **尺寸**: 80 x 80 像素
- **图标**: 手绘风格的皮革包图标，PNG格式，带Alpha通道
- **默认状态**: 60%不透明度
- **悬停状态**: 100%不透明度，0.2秒淡入动画
- **点击反馈**: 按钮缩小至95%，持续0.1秒后恢复，同时播放皮革摩擦音效
- **锚点**: 右下角锚点，确保在不同分辨率下保持相对位置

#### 菜单入口按钮
- **位置**: 屏幕右上角，距离右边缘和顶部边缘各60像素
- **尺寸**: 80 x 80 像素
- **图标**: 手绘风格的炼金术齿轮图标
- **状态与反馈**: 与背包按钮相同
- **锚点**: 右上角锚点

#### 交互提示系统
- **高亮轮廓**: 使用后期处理材质（Post-Process Material）实现，颜色为#C9A86B（暗金色），轮廓宽度3像素，外发光半径8像素
- **交互图标**: 
    - 尺寸: 64 x 64 像素
    - 位置: 屏幕中心偏下100像素
    - 不透明度: 70%
    - 动画: 淡入0.15秒，悬停时轻微缩放脉动（95%-105%，周期1.5秒）

### 2.2 背包系统 (Inventory)

**组件名称**: `WBP_Inventory`

#### 整体布局
- **出现动画**: 从屏幕底部向上滑动，持续0.3秒，使用Ease Out曲线
- **消失动画**: 向下滑动回屏幕底部，持续0.25秒
- **背景**: 深褐色皮革纹理（#3D2B1F），高度200像素，宽度占屏幕80%，居中对齐
- **阴影**: 向上投射柔和阴影，模糊半径20像素，不透明度40%

#### 物品槽
- **数量**: 7个
- **尺寸**: 每个120 x 120 像素
- **间距**: 槽与槽之间间隔20像素
- **背景**: 羊皮纸纹理（#EAE0C8），带有手绘边框
- **空槽状态**: 显示淡淡的炼金术符号水印
- **物品图标**: 居中显示，最大尺寸100 x 100像素，保持原始宽高比

#### 物品交互
- **选中效果**: 物品图标放大至130%，0.15秒Ease Out动画，同时播放"叮"的金属声
- **拖动状态**: 物品图标跟随手指/鼠标，不透明度降至80%，原槽位显示虚线边框
- **组合动画**: 
    - 两个物品飞向屏幕中央，持续0.4秒
    - 在中央旋转并发光，炼金术法阵从透明渐变至100%不透明度，持续0.6秒
    - 新物品生成并飞回背包，持续0.4秒
    - 总时长: 1.4秒

#### 观察模式按钮
- **位置**: 物品图标右上角
- **尺寸**: 24 x 24 像素
- **图标**: 放大镜，半透明
- **显示条件**: 仅在可观察物品上显示

### 2.3 对话与独白界面

**组件名称**: `WBP_Dialogue`

#### 文本框布局
- **位置**: 屏幕底部，距离底部边缘40像素
- **尺寸**: 宽度占屏幕90%，高度自适应文本内容（最小120像素，最大240像素）
- **背景**: 半透明深色矩形（#1A2930，60%不透明度），带有羊皮纸纹理叠加
- **内边距**: 上下30像素，左右40像素

#### 文本样式
- **字体**: Cormorant Garamond
- **字号**: 32像素（基于1920x1080）
- **颜色**: #EAE0C8（羊皮纸色）
- **行距**: 1.4倍字号
- **对齐**: 左对齐
- **打字机效果**: 每个字符间隔0.05秒出现，伴随沙沙声音效（音量随机波动10%）

#### 继续提示
- **图标**: 手绘向下箭头，位于文本框右下角
- **动画**: 上下浮动，幅度10像素，周期1秒
- **显示条件**: 文本全部显示完毕后出现

### 2.4 谜题界面

**组件名称**: `WBP_PuzzleView`（基类，具体谜题继承此类）

#### 通用元素
- **背景**: 场景特写视图，无额外UI背景
- **返回按钮**: 
    - 位置: 左上角，距离边缘各40像素
    - 尺寸: 60 x 60 像素
    - 图标: 手绘向左箭头
    - 状态: 默认50%不透明度，悬停时100%

#### 特定谜题控件示例

**音乐盒谜题** (`WBP_MusicBoxPuzzle`)
- **音符按钮**: 直接在3D音乐盒模型上放置交互热区，无独立UI元素
- **反馈**: 点击时音符发光并播放对应音调

**幻灯机谜题** (`WBP_ProjectorPuzzle`)
- **焦距滑块**: 
    - 位置: 幻灯机模型上的推杆位置
    - 可拖动范围: 200像素
    - 反馈: 拖动时画面模糊度实时变化

**娃娃机谜题** (`WBP_ClawMachinePuzzle`)
- **摇杆控件**: 
    - 位置: 屏幕左右两侧各一个
    - 尺寸: 150 x 150 像素的圆形区域
    - 交互: 支持360度拖动，中心回弹
    - 视觉: 半透明的摇杆底座和可移动的摇杆头

### 2.5 菜单系统

**主菜单** (`WBP_MainMenu`)

#### 背景
- **场景**: 动态的天文台场景，天体仪缓慢旋转
- **粒子效果**: 星尘粒子缓慢飘落
- **音乐**: 悠远、神秘的环境音乐

#### 交互元素
所有菜单选项都是场景中的3D对象，通过射线检测实现交互。

- **开始游戏**: 点击桌上的水晶球，球体发光并播放共鸣音效
- **继续游戏**: 点击日记本，日记本翻页动画
- **设置**: 点击齿轮，齿轮旋转
- **退出**: 点击门，门缓慢关闭

**暂停菜单** (`WBP_PauseMenu`)

#### 布局
- **背景遮罩**: 全屏黑色遮罩，50%不透明度
- **菜单面板**: 
    - 尺寸: 800 x 600 像素，居中
    - 背景: 羊皮纸纹理，带有手绘边框
    - 出现动画: 从小到大缩放，持续0.3秒，Ease Out

#### 选项按钮
- **样式**: 手写体文本，无按钮背景
- **尺寸**: 每个选项高度80像素
- **间距**: 选项间隔30像素
- **悬停效果**: 文本颜色从#3D2B1F变为#C9A86B，0.2秒过渡
- **点击效果**: 文本短暂放大至110%

**设置菜单** (`WBP_SettingsMenu`)

#### 音量控制
- **滑块设计**: 试管形状，液体高度代表音量
- **尺寸**: 宽度400像素，高度60像素
- **交互**: 拖动滑块手柄，液体高度实时变化
- **颜色**: 音乐为蓝色液体（#4A90E2），音效为红色液体（#E24A4A）

#### 语言选择
- **控件**: 下拉菜单，羊皮纸风格
- **选项**: 中文、English
- **图标**: 羽毛笔图标位于文本左侧

---

## 3. 动画与过渡效果

### 3.1 场景过渡

**淡入淡出** (`WBP_SceneTransition`)
- **效果**: 全屏黑色遮罩，从透明到不透明再到透明
- **持续时间**: 淡出0.5秒，停留0.3秒，淡入0.5秒
- **音效**: 淡出时播放低沉的钟声

**星空过渡** （用于章节间过渡）
- **效果**: 屏幕变为星空，星辰连线形成章节符号
- **持续时间**: 3秒
- **音乐**: 空灵的合成器音乐

### 3.2 符号获取动画

**展示序列** (`WBP_SymbolAcquired`)
1. **阶段1** (0-0.5秒): 场景变暗至30%亮度
2. **阶段2** (0.5-1.5秒): 符号从小到大出现在屏幕中央，旋转360度
3. **阶段3** (1.5-3.0秒): 符号发光，周围出现炼金术纹路和粒子效果
4. **阶段4** (3.0-3.5秒): 符号缩小并飞向背包或符号槽
5. **阶段5** (3.5-4.0秒): 场景恢复正常亮度

**音效**: 神圣的钟声 + 炼金术共鸣音

### 3.3 物品拾取动画

- **物品消失**: 0.2秒淡出，同时缩小至50%
- **飞行轨迹**: 贝塞尔曲线路径，从物品位置到背包按钮，持续0.6秒
- **到达反馈**: 背包按钮短暂放大至120%，持续0.15秒

---

## 4. 音效设计规范

### 4.1 UI交互音效

| 交互类型 | 音效描述 | 音量 | 格式 |
|---------|---------|------|------|
| 按钮点击 | 轻微的木质敲击声 | -12dB | WAV, 44.1kHz |
| 物品拾取 | 金属"叮"声 + 布料摩擦声 | -10dB | WAV, 44.1kHz |
| 背包打开 | 皮革展开声 | -14dB | WAV, 44.1kHz |
| 物品拖动 | 持续的轻微摩擦声 | -18dB | WAV, 44.1kHz, Loop |
| 物品组合 | 炼金术共鸣音 + 玻璃碰撞 | -8dB | WAV, 44.1kHz |
| 谜题完成 | 机械齿轮咬合声 + 钟声 | -6dB | WAV, 44.1kHz |
| 场景切换 | 低沉的钟声 | -10dB | WAV, 44.1kHz |

### 4.2 环境音效

- **博物馆**: 空旷的回声，偶尔的脚步声
- **天文台**: 齿轮转动声，风声
- **特写谜题**: 根据谜题类型定制（如音乐盒的机械音乐）

---

## 5. 性能优化指南

### 5.1 纹理优化

- **UI图标**: 使用Texture Atlas合并小图标，减少Draw Call
- **最大纹理尺寸**: 2048 x 2048
- **压缩格式**: Android使用ASTC或ETC2
- **Mipmap**: 为所有UI纹理生成Mipmap，提升缩放质量

### 5.2 动画优化

- **使用UMG动画**: 优先使用UMG的内置动画系统，而非每帧更新
- **避免过度绘制**: 隐藏的UI元素应设置为Collapsed而非Hidden
- **粒子效果**: 限制粒子数量，移动端单个效果不超过50个粒子

### 5.3 内存管理

- **UI预加载**: 常用UI（HUD、背包）在游戏启动时预加载
- **动态加载**: 谜题UI在需要时动态加载，完成后卸载
- **资源池**: 对频繁创建销毁的UI元素（如对话框）使用对象池

---

## 6. 可访问性设计

### 6.1 文本可读性

- **最小字号**: 28像素（基于1920x1080）
- **对比度**: 文本与背景对比度不低于4.5:1
- **字体选择**: 避免过于花哨的装饰字体，确保易读性

### 6.2 触控区域

- **最小触控区域**: 80 x 80 像素，确保手指能准确点击
- **安全间距**: 交互元素之间至少间隔20像素，防止误触

### 6.3 色盲友好

- **不仅依赖颜色**: 重要信息除了颜色外，还应有形状或文字标识
- **高对比模式**: 在设置中提供高对比度UI选项（可选）

---

## 7. 实现优先级

### 第一阶段（核心功能）
1. 主游戏界面（HUD）
2. 背包系统
3. 对话界面
4. 基础谜题界面框架

### 第二阶段（谜题实现）
5. 第一章谜题UI
6. 第二章谜题UI
7. 第三章谜题UI

### 第三阶段（完善与优化）
8. 菜单系统
9. 符号获取动画
10. 场景过渡效果
11. 音效整合
12. 性能优化

---

本技术规范文档为UI开发团队提供了详细的实现指导。所有参数均基于1920x1080基准分辨率，实际开发时应使用相对单位和锚点系统确保多分辨率适配。设计过程中应持续进行真机测试，确保在不同设备上的表现一致。
